---
import Layout from "../../layouts/Layout.astro";
import MoviesByGenre from "../../components/MoviesByGenre.svelte";

export async function getStaticPaths() {
  const options = {
    method: "GET",
    headers: {
      accept: "application/json",
      Authorization: import.meta.env.PUBLIC_API_ACCESS_TOKEN,
    },
  };

  const data = await fetch(
    `https://api.themoviedb.org/3/genre/movie/list?language=en`,
    options
  ).then((r) => r.json());

  return data.genres.map((x) => {
    return {
      params: { genre: x.name.toLowerCase() },
      props: { x },
    };
  });
}

const { x } = Astro.props;
---

<Layout title="Genre">
  <main class="container">
    <h1 id="movies-by-genre-header">{x["name"]}</h1>

    <ul class="mb-3">
      <MoviesByGenre client:only="svelte" genreId={x["id"]} />
    </ul>
  </main>
</Layout>
